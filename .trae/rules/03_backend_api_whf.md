# TRAI API 与协议规范
> **后端规则**: 本文件属于python3规范体系, 适用于所有后端开发人员.

## 1. 核心风格
- **RPC/POST**: 强制仅POST (禁GET/PUT); JSON为主; SSE/WS为辅; OpenAPI必填.
- **认证限流**: JWT+SSO; RBAC; IP/用户限流 (Redis/PG).
- **长任务管理**: 
  - 对于耗时任务 (如 AI 生成、文件处理)，推荐使用 **后台任务 (BackgroundTasks)** 或 **消息队列** 异步执行。
  - 必须支持任务状态查询接口，防止前端刷新页面后丢失进度。
  - **权限归属**: 必须记录任务归属用户，确保只有任务发起者或管理员可查询/操作。
  - **流式持久化**: AI流式对话等场景，必须在流结束后将 **完整响应内容** 拼接并存入数据库，禁止存储零散分片。
  - 客户端请求超时时间建议设为 **100s+**，服务端需配置合理的超时截断。

## 2. 响应体 (统一响应)
- **成功**: `{"code":200, "msg":"OK", "data":{...}, "req_id":"...", "ts":"..."}`
- **错误**: `{"code":400, "msg":"Err", "error":{"type":"...", "details":...}, ...}`
- **状态**: 200(OK), 400(Bad), 401(Unauth), 403(Forbid), 429(Limit), 500(Err).

## 3. 字段与头
- **规范**: `snake_case`; 分页(page/size/total/items); `X-Request-ID`必选.
