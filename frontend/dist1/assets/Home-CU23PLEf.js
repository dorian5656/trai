import{d as re,u as ce,af as de,G as D,o as ue,c as r,s as e,M as h,p as n,ae as d,F as O,ad as j,r as ge,B as g,m as w,y as f,A as ve,e as a,w as _,q as R,ak as pe,a2 as fe,al as me,aj as he,v as _e,ai as k,I as ke,a as ye,_ as be}from"./index-LA8rxSg-.js";import{u as Se,i as Ce,e as v,M as we,C as q,f as Me,S as Fe,j as Le,g as Te,h as De,c as Re,l as z,r as Be,m as xe,k as Ie}from"./dify-Dm1rxCaI.js";import{u as Ve}from"./github-dark-BiOJF1sg.js";const Ee={class:"mobile-container"},$e={class:"sidebar-header"},Ae={class:"user-info"},Pe={key:0,class:"avatar"},Ue=["src"],He={key:1,class:"avatar"},Ne={class:"username"},Oe={class:"action-area"},je={class:"recent-chats"},qe={class:"section-title"},ze=["onClick"],Ge={class:"action-menu"},Xe=["onClick"],Je=["onClick"],Ke={class:"sidebar-footer"},Qe={class:"footer-btn"},We={class:"mobile-header"},Ye={class:"left"},Ze={class:"right"},es={key:0,class:"user-actions"},ss={class:"mobile-content"},is={key:0,class:"chat-layout"},ns={class:"chat-footer"},ts={key:1,class:"welcome-wrapper"},os={class:"greeting"},ls={class:"input-area-wrapper"},as={class:"skills-grid"},rs=["onClick"],cs=["innerHTML"],ds={class:"skill-label"},us=re({__name:"Home",setup(gs){ye();const u=ce(),o=Ve(),c=de(),{isListening:B,result:G,toggleListening:x}=Se(),{uploadedFiles:y,showViewer:X,previewUrlList:J,initialIndex:K,handleFileSelect:I,removeFile:V,handlePreview:E,closeViewer:Q,clearFiles:W}=Te(),{allSkills:Y,activeSkill:b,handleSkillClick:Z,removeSkill:$}=De(),p=f(""),A=f(null),S=f(!1),C=f(!1),M=f(!1),F=f(!1);D(()=>o.messages,()=>{A.value?.scrollToBottom()},{deep:!0});const P=async()=>{const i=p.value.trim();if(!i&&y.value.length===0||o.isSending)return;const s=[...y.value],l=b.value;p.value="",W(),b.value=null,await o.sendMessage(i,s,l)},U=()=>{o.stopGenerating()},H=()=>{S.value=!S.value};D(G,i=>{i&&(p.value=i)}),D(()=>c.isLoggedIn,i=>{i?N():o.clearAllConversations()}),ue(async()=>{await c.init(),c.isLoggedIn&&N()});const N=async()=>{try{const i=c.username;if(!i||i==="æœªç™»å½•")return;const s=await Ce(i,50,"guanwang");let l=[];Array.isArray(s)?l=s:s&&s.data&&(l=s.data),o.difyConversations=l}catch(i){console.error("åŠ è½½ä¼šè¯å¤±è´¥",i)}},ee=async i=>{F.value=!0,o.clearSession(),o.setDifySessionId(i.id);try{const s=c.username||"guest",l=await Ie(i.id,s,50,"guanwang");let m=[];Array.isArray(l)?m=l:l&&l.data&&(m=l.data),o.replaceMessagesFromDify(m,i.name||"ä¼šè¯",i.id)}catch(s){console.error("åŠ è½½åŽ†å²æ¶ˆæ¯å¤±è´¥",s),k.error("åŠ è½½åŽ†å²æ¶ˆæ¯å¤±è´¥")}finally{F.value=!1}},se=async i=>{try{const{value:s}=await z.prompt("è¯·è¾“å…¥æ–°åç§°","é‡å‘½åä¼šè¯",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",inputValue:i.name,inputPattern:/\S/,inputErrorMessage:"åç§°ä¸èƒ½ä¸ºç©º"});s&&s!==i.name&&(await Be(i.id,s,"guanwang",!1),o.renameDifyConversation(i.id,s),k.success("é‡å‘½åæˆåŠŸ"))}catch(s){if(s==="cancel"||s==="close")return;k.error("é‡å‘½åå¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}},ie=async i=>{try{await z.confirm("ç¡®å®šè¦åˆ é™¤è¯¥ä¼šè¯å—ï¼Ÿåˆ é™¤åŽæ— æ³•æ¢å¤ã€‚","åˆ é™¤ç¡®è®¤",{confirmButtonText:"åˆ é™¤",cancelButtonText:"å–æ¶ˆ",type:"warning"}),await xe(i.id,"guanwang"),o.removeDifyConversation(i.id),k.success("åˆ é™¤æˆåŠŸ")}catch(s){if(s==="cancel"||s==="close")return;k.error("åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}},ne=()=>{u.openLoginModal()},te=()=>{c.logout()},oe=i=>{if(i.label==="ä¼šè®®è®°å½•"){M.value=!0;return}if(i.label==="ç›¸ä¼¼åº¦è¯†åˆ«"){C.value=!0;return}Z(i),ke(()=>{const s=document.querySelector(".input-box input");s&&s.focus()})},le=ve(()=>{const i=o.sessions.map(l=>({id:l.id,title:l.title,type:"local"})),s=o.difyConversations.map(l=>({id:l.id,title:l.name||"æ–°å¯¹è¯",type:"dify"}));return[...i,...s]}),ae=i=>{if(i.type==="local")o.switchSession(i.id);else{const s=o.difyConversations.find(l=>l.id===i.id);s&&ee(s)}u.closeMobileSidebar()};return(i,s)=>{const l=fe,m=Re;return a(),r("div",Ee,[e(u).isMobileSidebarOpen?(a(),r("div",{key:0,class:"sidebar-mask",onClick:s[0]||(s[0]=(...t)=>e(u).closeMobileSidebar&&e(u).closeMobileSidebar(...t))})):h("",!0),n("aside",{class:ge(["mobile-sidebar",{open:e(u).isMobileSidebarOpen}])},[n("div",$e,[n("div",Ae,[e(c).avatar?(a(),r("div",Pe,[n("img",{src:e(c).avatar,alt:"Avatar"},null,8,Ue)])):(a(),r("div",He,"ðŸ‘©â€ðŸ’»")),n("span",Ne,d(e(c).isLoggedIn?e(c).username:e(v).sidebar.usernameFallback),1)]),n("button",{class:"close-btn",onClick:s[1]||(s[1]=(...t)=>e(u).closeMobileSidebar&&e(u).closeMobileSidebar(...t))},d(e(v).sidebar.closeBtn),1)]),n("div",Oe,[n("button",{class:"new-chat-btn",onClick:s[2]||(s[2]=t=>e(o).createSession())},d(e(v).sidebar.newChatBtn),1)]),n("div",je,[n("div",qe,d(e(v).sidebar.recentSectionTitle),1),(a(!0),r(O,null,j(le.value,t=>(a(),r("div",{key:`${t.type}-${t.id}`,class:"chat-item",onClick:L=>ae(t)},[n("span",null,d(t.title),1),t.type==="dify"?(a(),w(m,{key:0,placement:"left",trigger:"click",width:180,"popper-class":"mobile-action-popover"},{reference:_(()=>[n("button",{class:"mini-icon-btn",onClick:s[3]||(s[3]=R(()=>{},["stop"]))},[g(l,null,{default:_(()=>[g(e(he))]),_:1})])]),default:_(()=>[n("div",Ge,[n("button",{class:"menu-item",onClick:R(L=>se(e(o).difyConversations.find(T=>T.id===t.id)),["stop"])},[g(l,null,{default:_(()=>[g(e(pe))]),_:1}),s[10]||(s[10]=n("span",null,"é‡å‘½å",-1))],8,Xe),n("button",{class:"menu-item danger",onClick:R(L=>ie(e(o).difyConversations.find(T=>T.id===t.id)),["stop"])},[g(l,null,{default:_(()=>[g(e(me))]),_:1}),s[11]||(s[11]=n("span",null,"åˆ é™¤",-1))],8,Je)])]),_:2},1024)):h("",!0)],8,ze))),128))]),n("div",Ke,[n("button",Qe,d(e(v).sidebar.aboutBtn),1)])],2),n("header",We,[n("div",Ye,[n("button",{class:"icon-btn",onClick:s[4]||(s[4]=(...t)=>e(u).toggleMobileSidebar&&e(u).toggleMobileSidebar(...t))},"â˜°"),n("button",{class:"new-chat-pill",onClick:s[5]||(s[5]=t=>e(o).createSession())},d(e(v).header.newChatPill),1)]),n("div",Ze,[e(c).isLoggedIn?(a(),r("div",es,[n("button",{class:"logout-btn",onClick:te},d(e(v).header.logout),1)])):(a(),r("button",{key:1,class:"login-btn",onClick:ne},d(e(v).header.login),1))])]),n("main",ss,[e(o).messages.length>0||F.value?(a(),r("div",is,[g(e(we),{messages:e(o).messages,ref_key:"messageListRef",ref:A},null,8,["messages"]),n("div",ns,[g(e(q),{modelValue:p.value,"onUpdate:modelValue":s[6]||(s[6]=t=>p.value=t),"is-sending":e(o).isSending,"is-deep-thinking":S.value,"active-skill":e(b),"uploaded-files":e(y),"is-listening":e(B),onSend:P,onStop:U,onToggleDeepThink:H,onToggleListening:e(x),onRemoveSkill:e($),onFileSelect:e(I),onRemoveFile:e(V),onPreviewFile:e(E)},null,8,["modelValue","is-sending","is-deep-thinking","active-skill","uploaded-files","is-listening","onToggleListening","onRemoveSkill","onFileSelect","onRemoveFile","onPreviewFile"])])])):(a(),r("div",ts,[n("h1",os,d(e(v).welcomeTitle),1),n("div",ls,[g(e(q),{modelValue:p.value,"onUpdate:modelValue":s[7]||(s[7]=t=>p.value=t),"is-sending":e(o).isSending,"is-deep-thinking":S.value,"active-skill":e(b),"uploaded-files":e(y),"is-listening":e(B),onSend:P,onStop:U,onToggleDeepThink:H,onToggleListening:e(x),onRemoveSkill:e($),onFileSelect:e(I),onRemoveFile:e(V),onPreviewFile:e(E)},null,8,["modelValue","is-sending","is-deep-thinking","active-skill","uploaded-files","is-listening","onToggleListening","onRemoveSkill","onFileSelect","onRemoveFile","onPreviewFile"])]),n("div",as,[(a(!0),r(O,null,j(e(Y),t=>(a(),r("div",{key:t.label,class:"skill-item",onClick:L=>oe(t)},[n("div",{class:"skill-icon-wrapper",style:_e({color:t.color})},[n("span",{class:"skill-icon",innerHTML:t.icon},null,8,cs)],4),n("span",ds,d(t.label),1)],8,rs))),128))])]))]),e(X)?(a(),w(e(Me),{key:1,"url-list":e(J),"initial-index":e(K),onClose:e(Q)},null,8,["url-list","initial-index","onClose"])):h("",!0),C.value?(a(),w(Fe,{key:2,visible:C.value,"onUpdate:visible":s[8]||(s[8]=t=>C.value=t)},null,8,["visible"])):h("",!0),M.value?(a(),w(Le,{key:3,onClose:s[9]||(s[9]=t=>M.value=!1)})):h("",!0)])}}}),ms=be(us,[["__scopeId","data-v-81a01bc6"]]);export{ms as default};
