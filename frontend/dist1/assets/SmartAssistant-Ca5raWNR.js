import{d as se,h as c,m as s,G as E,L as T,aa as U,k as I,z as k,j as _,y as oe,H as ve,f as u,w as ge,o as he,n as A,a3 as we,$ as ye,u as Z,F as G,Z as J,C as be,p as Ce,r as h,c as O}from"./index-D7nirgxF.js";import{z as ne,y as x}from"./_plugin-vue_export-helper-B8yqaaJu.js";import{M as ke,u as _e,s as Ie,H as X}from"./github-dark-Bx4mMapL.js";const f=[];for(let o=0;o<256;++o)f.push((o+256).toString(16).slice(1));function $e(o,r=0){return(f[o[r+0]]+f[o[r+1]]+f[o[r+2]]+f[o[r+3]]+"-"+f[o[r+4]]+f[o[r+5]]+"-"+f[o[r+6]]+f[o[r+7]]+"-"+f[o[r+8]]+f[o[r+9]]+"-"+f[o[r+10]]+f[o[r+11]]+f[o[r+12]]+f[o[r+13]]+f[o[r+14]]+f[o[r+15]]).toLowerCase()}let B;const Se=new Uint8Array(16);function xe(){if(!B){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");B=crypto.getRandomValues.bind(crypto)}return B(Se)}const Re=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ee={randomUUID:Re};function Me(o,r,g){o=o||{};const e=o.random??o.rng?.()??xe();if(e.length<16)throw new Error("Random bytes length must be >= 16");return e[6]=e[6]&15|64,e[8]=e[8]&63|128,$e(e)}function Te(o,r,g){return ee.randomUUID&&!o?ee.randomUUID():Me(o)}const re=async o=>(console.log("Mock submit customer info:",o),new Promise(r=>{setTimeout(()=>{r({success:!0,message:"提交成功 (Mock)"})},1e3)})),Ue={key:0,class:"form-body"},ze={class:"form-group"},De={key:0,class:"error-msg"},Le={class:"form-group"},Ee={key:0,class:"error-msg"},Fe={class:"form-group"},He={key:0,class:"error-msg"},Ve={class:"form-group"},Ae={key:0,class:"error-msg"},Be={class:"form-actions"},Pe=["disabled"],qe={key:1,class:"result-body"},Qe={key:0,class:"success-icon"},je={key:1,class:"error-icon"},Ne=se({__name:"ContactForm",emits:["close","submit"],setup(o,{emit:r}){const g=r,e=ve({show:!0,isSubmitting:!1,contact:{name:"",phone:"",product:"",zona:""},errors:{name:"",phone:"",product:"",zona:""},submitResult:{success:!1,message:"",showResult:!1}}),m=()=>{g("close")},b=()=>{let d=!0;const n=e.contact.name.trim();n?/^[\u4e00-\u9fa5a-zA-Z\s]{2,20}$/.test(n)?e.errors.name="":(e.errors.name="姓名请输入2-20个中英文字符",d=!1):(e.errors.name="请填写您的姓名",d=!1);const i=e.contact.phone.trim();return i?/^1[3-9]\d{9}$/.test(i)?e.errors.phone="":(e.errors.phone="请填写正确的11位手机号码",d=!1):(e.errors.phone="请填写您的联系电话",d=!1),e.contact.product.trim()?e.errors.product="":(e.errors.product="请填写您感兴趣的产品",d=!1),e.contact.zona.trim()?e.errors.zona="":(e.errors.zona="请填写您所在的区域",d=!1),d},y=async()=>{if(!e.isSubmitting&&b()){e.isSubmitting=!0,e.submitResult.showResult=!1;try{const d=await re(e.contact);e.submitResult={success:d.success,message:d.message,showResult:!0},d.success&&setTimeout(()=>{g("submit",e.contact)},1500)}catch(d){e.submitResult={success:!1,message:d.message||"网络异常，请重试",showResult:!0}}finally{e.isSubmitting=!1}}};return(d,n)=>e.show?(u(),c("div",{key:0,class:"contact-form-overlay",onClick:m},[s("div",{class:"contact-form-container",onClick:n[8]||(n[8]=oe(()=>{},["stop"]))},[s("div",{class:"form-header"},[n[9]||(n[9]=s("h3",null,"填写联系方式",-1)),s("span",{class:"close-btn",onClick:m},"×")]),e.submitResult.showResult?(u(),c("div",qe,[e.submitResult.success?(u(),c("div",Qe,"✓")):(u(),c("div",je,"!")),s("h3",null,k(e.submitResult.success?"提交成功":"提交失败"),1),s("p",null,k(e.submitResult.message),1),s("button",{class:"close-result-btn",onClick:m},"关闭")])):(u(),c("div",Ue,[n[14]||(n[14]=s("p",{class:"form-desc"},"请留下您的联系方式，我们将安排专人为您服务",-1)),s("div",ze,[n[10]||(n[10]=s("label",null,[E("姓名 "),s("span",{class:"required"},"*")],-1)),T(s("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=i=>e.contact.name=i),placeholder:"请输入您的姓名",class:I({error:e.errors.name}),onInput:n[1]||(n[1]=i=>e.errors.name="")},null,34),[[U,e.contact.name]]),e.errors.name?(u(),c("span",De,k(e.errors.name),1)):_("",!0)]),s("div",Le,[n[11]||(n[11]=s("label",null,[E("手机号码 "),s("span",{class:"required"},"*")],-1)),T(s("input",{type:"text","onUpdate:modelValue":n[2]||(n[2]=i=>e.contact.phone=i),placeholder:"请输入手机号码",class:I({error:e.errors.phone}),onInput:n[3]||(n[3]=i=>e.errors.phone=""),maxlength:"11"},null,34),[[U,e.contact.phone]]),e.errors.phone?(u(),c("span",Ee,k(e.errors.phone),1)):_("",!0)]),s("div",Fe,[n[12]||(n[12]=s("label",null,[E("感兴趣的产品 "),s("span",{class:"required"},"*")],-1)),T(s("input",{type:"text","onUpdate:modelValue":n[4]||(n[4]=i=>e.contact.product=i),placeholder:"例如：静脉留置针",class:I({error:e.errors.product}),onInput:n[5]||(n[5]=i=>e.errors.product="")},null,34),[[U,e.contact.product]]),e.errors.product?(u(),c("span",He,k(e.errors.product),1)):_("",!0)]),s("div",Ve,[n[13]||(n[13]=s("label",null,[E("所在区域 "),s("span",{class:"required"},"*")],-1)),T(s("input",{type:"text","onUpdate:modelValue":n[6]||(n[6]=i=>e.contact.zona=i),placeholder:"例如：河南省长垣市",class:I({error:e.errors.zona}),onInput:n[7]||(n[7]=i=>e.errors.zona="")},null,34),[[U,e.contact.zona]]),e.errors.zona?(u(),c("span",Ae,k(e.errors.zona),1)):_("",!0)]),s("div",Be,[s("button",{class:"submit-btn",disabled:e.isSubmitting,onClick:y},k(e.isSubmitting?"提交中...":"立即提交"),9,Pe)])]))])])):_("",!0)}}),Ke=ne(Ne,[["__scopeId","data-v-854b6ce3"]]),te="/assets/smart-assistant-ChP_cCZM.png",We=async()=>{const o=["驼人集团最近有什么新产品上市?","驼人集团签约合作的医院有哪些?","想咨询掌超产品?怎么联系?","驼人医疗器械科技创新奖怎么报名?","驼人集团是做什么的?","我想经营驼人的产品应该怎么做?","驼人有没有(产品名称)?","驼人的公司地点在哪里?","我是(学校、专业等)有合适的岗位吗?","驼人有哪些岗位在招聘?"];return new Promise(r=>{r({code:200,data:o})})};function ae(o,r,g=365){let e="";if(g){const m=new Date;m.setTime(m.getTime()+g*24*60*60*1e3),e="; expires="+m.toUTCString()}document.cookie=o+"="+(r||"")+e+"; path=/"}function Ye(o){const r=o+"=",g=document.cookie.split(";");for(let e=0;e<g.length;e++){let m=g[e]||"";for(;m.charAt(0)==" ";)m=m.substring(1,m.length);if(m.indexOf(r)==0)return m.substring(r.length,m.length)}return null}const P="trai_user_id";async function Ze(){let o=Ye(P);const r="未知";return o||(o=`user_${Te().slice(0,8)}`,ae(P,o)),{userId:o,province:r}}function Ge(o){ae(P,o)}const Je={class:"chat-body"},Oe={key:0,class:"welcome-container"},Xe={class:"chat-avatar-wrapper"},et=["src"],tt={class:"example-questions"},st=["onClick"],ot={key:0,class:"ai-avatar"},nt=["src"],rt={class:"message-wrapper"},at=["innerHTML"],lt={class:"chat-input-area"},it=["disabled"],ut={key:0,width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor"},ct={key:1,width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor"},dt=se({__name:"SmartAssistant",props:{showChatDirectly:{type:Boolean,default:!0}},setup(o){const r=o,g=new ke({html:!0,linkify:!0,breaks:!0,highlight:function(l,t){if(t&&X.getLanguage(t))try{return'<pre class="hljs"><code>'+X.highlight(l,{language:t,ignoreIllegals:!0}).value+"</code></pre>"}catch{}return'<pre class="hljs"><code>'+g.utils.escapeHtml(l)+"</code></pre>"}}),e=g.renderer.rules.link_open||function(l,t,a,v,w){return w.renderToken(l,t,a)};g.renderer.rules.link_open=function(l,t,a,v,w){const p=l[t];return p.attrSet("target","_blank"),p.attrSet("rel","noopener noreferrer"),e(l,t,a,v,w)};const m=h(!1),b=h(""),y=h([]),d=h(!1),n=h(!1),i=h(!1),F=h(null),R=h(null),le=h(null),q=h(null),$=h(!1),S=h(!1),Q=h([]),j=h([]),N=h(""),z=_e(),ie=O(()=>b.value.trim().length>0),H=O(()=>i.value&&z.abortController!==null);ge($,l=>{window.parent!==window&&window.parent.postMessage({type:"setControlsVisibility",visible:!l},"*")});const ue=()=>`${Date.now()}-${Math.random().toString(36).slice(-6)}`,K=(l,t=!0)=>{if(!l)return"";try{let a=l;return t&&(a=l.replace(/\[点击留下\]\(contact\)/g,'<span class="leave-contact" style="cursor: pointer; color: #2473ba; text-decoration: underline;">点击留下</span>')),g.render(a)}catch{return l}},D=()=>A(()=>{R.value&&R.value.scrollTo({top:R.value.scrollHeight,behavior:"smooth"})}),W=l=>{if(y.value.length===0)return;const t=y.value[y.value.length-1];t&&(t.text=l,t.renderedText=K(l),D())},M=(l,t)=>{const a=ue();let v=K(t,!0);t.includes('<span class="leave-contact"')&&(v=v.replace(/<span class="leave-contact" style="cursor: pointer; color: #2473ba; text-decoration: underline;">点击留下<\/span>/g,`<span class="leave-contact" onclick="window.parent.postMessage({type:'openContactForm', source:'${a}'}, '*')">点击留下</span>`)),y.value.push({id:a,sender:l,text:t,renderedText:v}),D()},Y=async l=>{try{const t=await re(l);t.success?($.value=!1,M("ai","感谢您的留资，我们将尽快与您联系。"),x.success("表单提交成功！")):x.error(t.message||"提交失败")}catch(t){console.error(t),x.error("提交失败，请稍后重试")}},ce=()=>{z.abortController&&(z.abortController.abort(),z.abortController=null,i.value=!1,n.value=!1,x.info("已停止生成"))},L=async l=>{const t=l.trim();if(!t||i.value)return;i.value=!0,n.value=!0,d.value=!0,M("user",t),b.value="",M("ai","正在思考......");const a=N.value||"guest_user";await Ie({query:t,user:a,conversation_id:F.value||void 0,app_name:"guanwang",mode:"chat",inputs:{},isPublic:!0},(v,w)=>{n.value=!1,W(v),w&&(F.value=w)},()=>{i.value=!1,n.value=!1,y.value.filter(w=>w.sender==="user").length<=1&&setTimeout(()=>{M("ai","感谢您的咨询！如果您对我们的产品感兴趣，请[点击留下](contact)您的联系方式和感兴趣的产品/业务，我们将有专人与您联系。")},1e3)},v=>{console.error(v),i.value=!1,n.value=!1,W("网络异常，请稍后重试"),x.error("请求失败")})},de=l=>{const t=l.target;window.parent!==window&&window.parent.postMessage({type:"iframeClick",element:t.tagName,text:t.textContent,id:t.id},"*")},me=l=>{const t=l.currentTarget;if(!t)return;const{scrollTop:a,scrollHeight:v,clientHeight:w}=t,p=a+w>=v-1;l.deltaY>0&&p||l.deltaY<0},pe=()=>{S.value=!1,window.parent!==window&&window.parent.postMessage({type:"confirmClose"},"*")},fe=()=>{S.value=!1,$.value=!0},V=(l="")=>{$.value=!0};return he(async()=>{window!==window.top&&(document.documentElement.setAttribute("data-iframe","true"),console.log("[SmartAssistant] 检测到iframe环境，已应用iframe样式"));const{userId:t}=await Ze();N.value=t,Ge(t);const a=await We();Q.value=a.data||[],j.value=[...Q.value].sort(()=>Math.random()-.5).slice(0,3),window.showCloseConfirmDialog=()=>{S.value=!0},window.openContactForm=()=>{V("消息链接")},window.showContactFormDialog=()=>{V("点击链接")},document.body.addEventListener("click",p=>{de(p);const C=p.target;(C.classList?.contains("leave-contact")||C.parentElement&&C.parentElement.classList?.contains("leave-contact"))&&(p.preventDefault(),p.stopPropagation(),V("点击链接"))}),window.addEventListener("message",p=>{if(p.data&&p.data.type){if(p.data.type==="showCloseConfirm"){S.value=!0;return}if(p.data.type==="formSubmitted"){const C=p.data.formData;C&&Y(C)}else if(p.data.type==="showSuccessMessage"){d.value=!0;const C=p.data.message||"感谢您的留资，我们将尽快与您联系。";M("ai",C),x.success("表单提交成功！")}}});const w=new URLSearchParams(window.location.search).get("question");w&&setTimeout(()=>{L(w)},500),window.addEventListener("resize",()=>{q.value&&r.showChatDirectly&&A(D)})}),we(()=>{window.openContactForm=void 0,window.showCloseConfirmDialog=void 0,window.showContactFormDialog=void 0}),ye(()=>{A(D)}),(l,t)=>(u(),c("div",null,[s("div",{class:I(["chat-window",{"is-maximized":m.value}]),ref_key:"chatWindowRef",ref:q},[t[12]||(t[12]=s("div",{class:"chat-header"},[s("div",{class:"header-icons"})],-1)),s("div",Je,[d.value?(u(),c("div",{key:1,ref_key:"chatHistoryRef",ref:R,class:"chat-history",onWheel:me},[(u(!0),c(G,null,J(y.value,a=>(u(),c("div",{key:a.id,class:I(["message-row",`message-${a.sender}`])},[a.sender==="ai"?(u(),c("div",ot,[s("img",{src:Z(te),alt:"AI"},null,8,nt)])):_("",!0),s("div",rt,[s("div",{class:I(["message-content",{thinking:n.value&&a===y.value[y.value.length-1]&&a.sender==="ai"}]),innerHTML:a.renderedText},null,10,at)])],2))),128))],544)):(u(),c("div",Oe,[s("div",Xe,[s("img",{src:Z(te),alt:"AI助手",class:"chat-avatar-img"},null,8,et)]),t[7]||(t[7]=s("div",{class:"message-box"},[s("p",{class:"greeting"},"您好，我是智小驼 (测试版)"),s("p",{class:"intro"},"任何关于驼人集团的问题都可以问我，请在输入框输入您的问题。")],-1)),s("div",tt,[t[6]||(t[6]=s("p",{class:"title"},"您可以试着这样问：",-1)),(u(!0),c(G,null,J(j.value,(a,v)=>(u(),c("div",{key:v,onClick:w=>L(a),class:"question"},k(a),9,st))),128))])])),s("div",lt,[T(s("input",{ref_key:"inputRef",ref:le,"onUpdate:modelValue":t[0]||(t[0]=a=>b.value=a),onKeyup:t[1]||(t[1]=be(a=>L(b.value),["enter"])),placeholder:"请输入您的问题"},null,544),[[U,b.value]]),s("button",{onClick:t[2]||(t[2]=a=>H.value?ce():L(b.value)),disabled:!ie.value&&!H.value},[H.value?(u(),c("svg",ut,[...t[8]||(t[8]=[s("path",{d:"M6 6h12v12H6z"},null,-1)])])):(u(),c("svg",ct,[...t[9]||(t[9]=[s("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2 .01 9z"},null,-1)])]))],8,it)]),t[10]||(t[10]=s("div",{class:"chat-footer"}," 内容由AI生成，仅供参考 ",-1))]),S.value?(u(),c("div",{key:0,class:"chat-confirm-overlay",onClick:t[4]||(t[4]=a=>S.value=!1)},[s("div",{class:"chat-confirm-dialog",onClick:t[3]||(t[3]=oe(()=>{},["stop"]))},[s("div",{class:"confirm-body"},[t[11]||(t[11]=s("p",null,"请留下您的联系方式和感兴趣的产品/业务，我们能更好地为您服务！",-1)),s("div",{class:"confirm-buttons"},[s("button",{onClick:fe,class:"confirm-btn"},"点击留资"),s("button",{onClick:pe,class:"cancel-btn"},"仍要关闭")])])])])):_("",!0)],2),$.value?(u(),Ce(Ke,{key:0,onClose:t[5]||(t[5]=a=>$.value=!1),onSubmit:Y})):_("",!0)]))}}),vt=ne(dt,[["__scopeId","data-v-2f1ba78a"]]);export{vt as default};
